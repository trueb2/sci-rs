#!/usr/bin/env bash
set -euo pipefail

remote_name="${1:-}"
remote_url="${2:-}"

# Block pushes to known upstream repos outside the fork.
if [[ "${remote_url}" =~ github\.com[:/](qsib-cbie|No9)/sci-rs(\.git)?$ ]]; then
  echo "pre-push: refusing push to upstream remote: ${remote_url}"
  exit 1
fi

# Block pushes to main regardless of remote.
while read -r local_ref local_sha remote_ref remote_sha; do
  if [[ "${remote_ref}" == "refs/heads/main" ]]; then
    echo "pre-push: refusing push to refs/heads/main on remote '${remote_name}'."
    exit 1
  fi
done

exit 0
